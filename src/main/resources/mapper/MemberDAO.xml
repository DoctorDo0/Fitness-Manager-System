<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.demo05.dao.MemberDAO">
    <!--不指定active内容时，查询active=1的数据，配合删除使用-->
    <select id="selectAll" resultType="MemberBean">
        select
        id,member_id,name,gender,birthday,phone,email,wechat,qq,register_date,register_by,update_date,update_by,description,balance
        from gym_member
        <where>
            <if test="id != null and id !=''">
                and id = #{id}
            </if>
            <if test="memberId != null and memberId !=''">
                <bind name="memberIdLike" value="'%'+memberId+'%'"/>
                and member_id like #{memberIdLike}
            </if>
            <if test="name != null and name != ''">
                <bind name="nameLike" value="'%'+name+'%'"/>
                and `name` like #{nameLike}
            </if>
            <if test="gender != null and gender != ''">
                and gender = #{gender}
            </if>
            <if test="birthdayStart != null">
                and birthday &gt;= #{birthdayStart}
            </if>
            <if test="birthdayEnd != null">
                and birthday &lt;= #{birthdayEnd}
            </if>
            <if test="phone != null and phone != ''">
                <bind name="phoneLike" value="'%'+phone+'%'"/>
                and phone like #{phoneLike}
            </if>
            <if test="registerDateFrom != null">
                and register_date &gt;= #{registerDateFrom}
            </if>
            <if test="registerDateTo != null">
                and register_date &lt;= #{registerDateTo}
            </if>
            <if test="registerBy != null and registerBy != ''">
                and register_by = #{registerBy}
            </if>
            <if test="updateDateFrom != null">
                and update_date &gt;= #{updateDateFrom}
            </if>
            <if test="updateDateTo != null">
                and update_date &lt;= #{updateDateTo}
            </if>
            <if test="updateBy != null and updateBy != ''">
                and update_by = #{updateBy}
            </if>
            <if test="balanceFrom != null and balanceFrom != ''">
                and balance &gt;= #{balanceFrom}
            </if>
            <if test="balanceTo != null and balanceTo != ''">
                and balance &lt;= #{balanceTo}
            </if>
            <if test="active == null or active == ''">
                and `active` = 1
            </if>
            <if test="active != null and active != ''">
                and `active` = #{active}
            </if>
        </where>
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        insert into gym_member (member_id, member_password, name, gender, birthday, phone, email, wechat, qq,
                                register_date, register_by, update_date, update_by, description, balance, active)
        values (#{memberId}, #{memberPassword}, #{name}, #{gender}, #{birthday}, #{phone}, #{email}, #{wechat}, #{qq},
                #{registerDate}, #{registerBy}, #{updateDate}, #{updateBy}, #{description}, 0, 1)
    </insert>

    <update id="updateByPrimaryKey">
        update gym_member
        set member_id = #{memberId},
        <if test="memberPassword!=null and memberPassword!=''">
            member_password = #{memberPassword},
        </if>
        name = #{name},
        gender = #{gender},
        birthday = #{birthday},
        phone = #{phone},
        email = #{email},
        wechat = #{wechat},
        qq = #{qq},
        update_date = #{updateDate},
        update_by = #{updateBy},
        description = #{description}
        where id = #{id}
    </update>

    <!--    <delete id="deleteByPrimaryKey">-->
    <!--        delete from gym_member where id in-->
    <!--        <foreach collection="ids" open="(" close=")" separator="," item="id">-->
    <!--            #{id}-->
    <!--        </foreach>-->
    <!--    </delete>-->

    <!--使用标志位替换删除功能-->
    <delete id="deleteByPrimaryKey">
        update gym_member set `active` = 0,update_date = #{auditEntity.updateDate},update_by=#{auditEntity.updateBy}
        where id in
        <foreach collection="ids" open="(" close=")" separator="," item="id">
            #{id}
        </foreach>
    </delete>

</mapper>